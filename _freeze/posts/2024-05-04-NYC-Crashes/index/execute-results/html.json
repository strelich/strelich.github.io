{
  "hash": "66a3173914f1b526e9b9077074c8dd75",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"NYC Crash Data\"\ndescription: \"Exploring a data set of motor vehicle crashes in New York City\"\nauthor: \"Jack Strelich\"\ndate: 2024-05-06\ncategories: [R, Data Cleaning, Data Visualization, Mapping]\nformat: \n  html: \n    df-print: paged\nimage: \"index_files/figure-html/fig-choropleth-1.png\"\n---\n\n\n# Overview\n\nIn this post, I'll explore a data set of motor vehicle crashes in New York City obtained via [data.gov](https://catalog.data.gov/dataset/motor-vehicle-collisions-crashes). This data set interested me for two reasons. First, it's quite comprehensive, covering all crashes resulting in injury and/or over $1000 in damage since mid-2012. Second, it's messy in a way that's very representative of real-world data (and very hard to replicate with more \"shrink-wrapped\" data sets).\n\nMy goals for this analysis were to perform some basic data cleaning, get some insights from the data, and practice a type of visualization I don't get to use very often in my day job: the [choropleth map](https://en.wikipedia.org/wiki/Choropleth_map)!\n\nTo start, we'll load the packages we need:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load packages\n## Handling dates\nlibrary(lubridate)\n\n## Mapping\nlibrary(sf)\nlibrary(nycgeo)\n\n## And starring...\nlibrary(tidyverse)\n\n# Set theme for plots\ntheme_set(theme_minimal())\n```\n:::\n\n\nNow we'll read in the data. Because the CSV is so large (~437 Mb), I decided to read it directly via the URL, rather than downloading and reading the file[^speed]. Once the data is loaded, we'll tweak the column names for readability (converting to sentence case and replacing spaces with underscores), read the `Crash_date` column via `lubridate::as_date()`, and change the names of the columns containing vehicle type codes to be consistent with other column names. We'll also filter the data to look only at crashes in 2023, to avoid using too much memory[^memory].\n\n[^speed]: In general, `vroom::vroom()` is much [faster](https://vroom.r-lib.org/articles/benchmarks.html) than `read.csv()`, but here we're also limited by connection speed; it took a little over a minute to read the data in with this approach. \n\n[^memory]: There are a number of approaches for dealing with very large (and larger-than-memory) data sets, which I hope to cover in future posts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load crash data (https://data.cityofnewyork.us/api/views/h9gi-nx95/rows.csv)\ncrash_url <- \"https://data.cityofnewyork.us/api/views/h9gi-nx95/rows.csv\"\n\n# Load data (takes a minute!)\ncrash_dat <- vroom::vroom(file = crash_url, # Read from URL\n                          guess_max = 10^3,\n                          .name_repair = ~str_replace_all(str_to_sentence(.x), \n                                                          pattern = \" \", \n                                                          replacement = \"_\")) %>%  \n  mutate(Crash_date= as_date(Crash_date, format = \"%m/%d/%Y\")) %>% \n  filter(year(Crash_date) == 2023) %>% # Only 2023 data\n  rename_with(\\(var) str_replace_all(var, \n                                     pattern = \"Vehicle_type_code\", \n                                     replacement = \"Type_code_vehicle\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 2084770 Columns: 29\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (16): Crash_date, Borough, Location, On_street_name, Cross_street_name,...\ndbl  (12): Zip_code, Latitude, Longitude, Number_of_persons_injured, Number_...\ntime  (1): Crash_time\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n\n# Exploring the data\n\nEach row of the data set represents a single incident (crash), and records the date/time, location (borough, ZIP code, latitude/longitude, street name), deaths/injuries, the type(s) of vehicle(s) involved, and contributing factors for each vehicle.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(crash_dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 96,581\nColumns: 29\n$ Crash_date                    <date> 2023-12-18, 2023-12-18, 2023-11-17, 202…\n$ Crash_time                    <time> 03:40:00, 11:10:00, 23:20:00, 07:26:00,…\n$ Borough                       <chr> NA, NA, NA, NA, \"MANHATTAN\", \"MANHATTAN\"…\n$ Zip_code                      <dbl> NA, NA, NA, NA, 10036, 10011, 10472, 104…\n$ Latitude                      <dbl> 40.74660, 40.72258, 40.71664, 40.66688, …\n$ Longitude                     <dbl> -73.76503, -73.94049, -73.97561, -73.945…\n$ Location                      <chr> \"(40.7466, -73.76503)\", \"(40.722576, -73…\n$ On_street_name                <chr> \"LONG ISLAND EXPRESSWAY\", \"BROOKLYN QUEE…\n$ Cross_street_name             <chr> NA, NA, NA, NA, \"WEST 47 STREET\", NA, NA…\n$ Off_street_name               <chr> NA, NA, NA, NA, NA, \"13        WEST 13 S…\n$ Number_of_persons_injured     <dbl> 0, 0, 0, 2, 2, 2, 0, 0, 0, 0, 0, 0, 2, 1…\n$ Number_of_persons_killed      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ Number_of_pedestrians_injured <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ Number_of_pedestrians_killed  <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ Number_of_cyclist_injured     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ Number_of_cyclist_killed      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ Number_of_motorist_injured    <dbl> 0, 0, 0, 2, 2, 2, 0, 0, 0, 0, 0, 0, 2, 1…\n$ Number_of_motorist_killed     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ Contributing_factor_vehicle_1 <chr> \"Pavement Slippery\", \"Following Too Clos…\n$ Contributing_factor_vehicle_2 <chr> NA, \"Unspecified\", \"Unspecified\", \"Traff…\n$ Contributing_factor_vehicle_3 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ Contributing_factor_vehicle_4 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ Contributing_factor_vehicle_5 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ Collision_id                  <dbl> 4688250, 4688384, 4688910, 4688735, 4688…\n$ Type_code_vehicle_1           <chr> \"Station Wagon/Sport Utility Vehicle\", \"…\n$ Type_code_vehicle_2           <chr> NA, \"Carry All\", \"Sedan\", \"School bus\", …\n$ Type_code_vehicle_3           <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ Type_code_vehicle_4           <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ Type_code_vehicle_5           <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n```\n\n\n:::\n:::\n\n\n\n## Time and date\n\nFirst, let's look at incidents by month:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crash_dat, aes(x = month(Crash_date, label = TRUE))) + \n  geom_bar() +\n  labs(x = \"Month\", y = \"Incidents\")\n```\n\n::: {.cell-output-display}\n![Incidents by date](index_files/figure-html/fig-incidents-by-date-1.png){#fig-incidents-by-date width=672}\n:::\n:::\n\n\n\nNo obvious differences by month/season! Next, let's consider crash times. Looking at raw crash time data, there seems to be an unusually high number of crashes at exactly midnight (`00:00`):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncount(crash_dat, Crash_time,sort = TRUE) %>% head(n=10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Crash_time\"],\"name\":[1],\"type\":[\"time\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"00:00:00\",\"2\":\"1616\"},{\"1\":\"15:00:00\",\"2\":\"926\"},{\"1\":\"17:00:00\",\"2\":\"890\"},{\"1\":\"16:00:00\",\"2\":\"857\"},{\"1\":\"08:00:00\",\"2\":\"833\"},{\"1\":\"18:00:00\",\"2\":\"810\"},{\"1\":\"14:00:00\",\"2\":\"796\"},{\"1\":\"09:00:00\",\"2\":\"786\"},{\"1\":\"13:00:00\",\"2\":\"786\"},{\"1\":\"12:00:00\",\"2\":\"765\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nIn fact, we see almost twice as many crashes reported at midnight as at 5pm! This makes me suspect that in at least some cases a crash time of `00:00` represents missing data; for the purposes of this graph, we'll exclude them. \n\nNow to see whether the time that incidents occurred varied by month. To help us compare months, we'll use a ridgeline plot[^ridgeline], via `ggridges::geom_density_ridges()`:\n\n[^ridgeline]: Obligatory reference to [that one Joy Division album cover](https://en.wikipedia.org/wiki/Unknown_Pleasures#Artwork_and_packaging).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrash_dat %>% \n  filter(Crash_time > 0) %>% \n  mutate(Crash_month = month(Crash_date, label = TRUE)) %>% \n  ggplot(aes(x=Crash_time, \n             color=Crash_month,\n             fill=Crash_month,\n             y = fct_rev(Crash_month))) + \n  ggridges::geom_density_ridges(alpha = 0.4,\n                                quantile_lines = TRUE,\n                                quantiles = 2) +\n  scale_color_viridis_d() +\n  scale_x_time(breaks = (0:6)*14400) +\n  labs(x = \"Time of day\", y = \"Month\", \n       caption = \"Vertical lines represent median.\") + \n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Incidents by month and time of day](index_files/figure-html/fig-incidents-time-month-1.png){#fig-incidents-time-month width=672}\n:::\n:::\n\n\nCrashes by time of day look fairly consistent across months; notice that the median of each distribution is around 2pm. Additionally, we can see peaks in the number of incidents between 8-9am and between 5-6pm (representing rush hour, I'm assuming).\n\n## Injuries and fatalities\n\nTo explore crash outcomes, we'll use `pivot_longer()` to make a data frame with multiple rows per crash, each row representing the number of motorists, cyclists, or pedestrians (`Type`) who were injured or killed (`Outcome`) in that crash.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutcomes_by_crash <- crash_dat %>% \n  select(Collision_id, \n         starts_with(\"Crash\"), # Keep date and time\n         starts_with(\"Number_of_\")) %>%\n  pivot_longer(cols = starts_with(\"Number_of_\"), \n               names_prefix = \"Number_of_\", # Clean up col names\n               names_sep = \"\\\\_\", # Split at underscore\n               names_to = c(\"Type\",\"Outcome\")) %>% \n  mutate(Crash_month = month(Crash_date, label = TRUE),\n         Type = str_to_title(Type),\n         Outcome = str_to_title(Outcome))\n\n# Check our work\nhead(outcomes_by_crash, n = 10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Collision_id\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Crash_date\"],\"name\":[2],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"Crash_time\"],\"name\":[3],\"type\":[\"time\"],\"align\":[\"right\"]},{\"label\":[\"Type\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Outcome\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"value\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Crash_month\"],\"name\":[7],\"type\":[\"ord\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"4688250\",\"2\":\"2023-12-18\",\"3\":\"03:40:00\",\"4\":\"Persons\",\"5\":\"Injured\",\"6\":\"0\",\"7\":\"Dec\"},{\"1\":\"4688250\",\"2\":\"2023-12-18\",\"3\":\"03:40:00\",\"4\":\"Persons\",\"5\":\"Killed\",\"6\":\"0\",\"7\":\"Dec\"},{\"1\":\"4688250\",\"2\":\"2023-12-18\",\"3\":\"03:40:00\",\"4\":\"Pedestrians\",\"5\":\"Injured\",\"6\":\"0\",\"7\":\"Dec\"},{\"1\":\"4688250\",\"2\":\"2023-12-18\",\"3\":\"03:40:00\",\"4\":\"Pedestrians\",\"5\":\"Killed\",\"6\":\"0\",\"7\":\"Dec\"},{\"1\":\"4688250\",\"2\":\"2023-12-18\",\"3\":\"03:40:00\",\"4\":\"Cyclist\",\"5\":\"Injured\",\"6\":\"0\",\"7\":\"Dec\"},{\"1\":\"4688250\",\"2\":\"2023-12-18\",\"3\":\"03:40:00\",\"4\":\"Cyclist\",\"5\":\"Killed\",\"6\":\"0\",\"7\":\"Dec\"},{\"1\":\"4688250\",\"2\":\"2023-12-18\",\"3\":\"03:40:00\",\"4\":\"Motorist\",\"5\":\"Injured\",\"6\":\"0\",\"7\":\"Dec\"},{\"1\":\"4688250\",\"2\":\"2023-12-18\",\"3\":\"03:40:00\",\"4\":\"Motorist\",\"5\":\"Killed\",\"6\":\"0\",\"7\":\"Dec\"},{\"1\":\"4688384\",\"2\":\"2023-12-18\",\"3\":\"11:10:00\",\"4\":\"Persons\",\"5\":\"Injured\",\"6\":\"0\",\"7\":\"Dec\"},{\"1\":\"4688384\",\"2\":\"2023-12-18\",\"3\":\"11:10:00\",\"4\":\"Persons\",\"5\":\"Killed\",\"6\":\"0\",\"7\":\"Dec\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nNow we can plot total injuries/fatalities for motorists, cyclists, and pedestrians by month. Because fatalities are (thankfully) far rarer than injuries, we'll use the `scales = \"free_y\"` argument to `facet_wrap()` to let the two halves of the plot use different y-axis limits. We'll also use `fct_reorder()` to make sure the ordering of categories in the legend matches the ordering of the categories in the graph itself.\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutcomes_by_crash %>% \n  filter(Type != \"Persons\") %>% \n  mutate(Type = fct_reorder(Type, value, sum, .desc = T)) %>% \n  ggplot(aes(x = Crash_month, \n             y = value, \n             color = Type,\n             group = Type)) + \n  stat_summary(geom=\"line\", fun = \"sum\") +\n  stat_summary(geom=\"point\", fun = \"sum\") + \n  facet_wrap(~Outcome,\n             scales = \"free_y\",\n             nrow = 2) + \n  labs(y = \"Number of persons\", x= \"Month\")\n```\n\n::: {.cell-output-display}\n![Injuries and fatalities by month](index_files/figure-html/fig-injuries-fatalities-month-1.png){#fig-injuries-fatalities-month width=672}\n:::\n:::\n\n\nInterestingly, injuries and fatalities for motorists seem to be highest in summer, while injuries and fatalities for pedestrians are lower during these months.\n\n## Vehicles\n\nNext, let's explore the contributing factors and types of vehicles involved. \n\n### Cleaning\n\nWe'll restructure the data such that each row represents one *vehicle*, rather than one incident!\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvehicle_dat <- crash_dat %>% \n  select(Collision_id, starts_with(c(\"Contributing_factor\",\"Type_code\"))) %>% \n  pivot_longer(-Collision_id, \n               names_sep = \"_vehicle_\", \n               names_to = c(\".value\",\"Vehicle\")) %>% \n  drop_na() %>% \n  mutate(Vehicle = as.factor(as.numeric(Vehicle)))\n```\n:::\n\n\nNow we can look at the different vehicle type codes and contributing factors that occur in the data:\n\n\n::: {#tbl-incidents-by-vehicle-type-factor-raw .cell tbl-cap='Incidents by vehicle type and contributing factor (raw)'}\n\n```{.r .cell-code}\ncount(vehicle_dat, Type_code, sort = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Type_code\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Sedan\",\"2\":\"74552\"},{\"1\":\"Station Wagon/Sport Utility Vehicle\",\"2\":\"57236\"},{\"1\":\"Bike\",\"2\":\"5444\"},{\"1\":\"Pick-up Truck\",\"2\":\"4189\"},{\"1\":\"Taxi\",\"2\":\"3787\"},{\"1\":\"Box Truck\",\"2\":\"3655\"},{\"1\":\"Bus\",\"2\":\"3424\"},{\"1\":\"E-Bike\",\"2\":\"2546\"},{\"1\":\"Motorcycle\",\"2\":\"2019\"},{\"1\":\"Moped\",\"2\":\"1701\"},{\"1\":\"E-Scooter\",\"2\":\"1518\"},{\"1\":\"Tractor Truck Diesel\",\"2\":\"1369\"},{\"1\":\"Van\",\"2\":\"1116\"},{\"1\":\"Ambulance\",\"2\":\"942\"},{\"1\":\"Dump\",\"2\":\"566\"},{\"1\":\"PK\",\"2\":\"425\"},{\"1\":\"Garbage or Refuse\",\"2\":\"392\"},{\"1\":\"Flat Bed\",\"2\":\"363\"},{\"1\":\"Convertible\",\"2\":\"329\"},{\"1\":\"Motorscooter\",\"2\":\"312\"},{\"1\":\"Carry All\",\"2\":\"254\"},{\"1\":\"Tow Truck / Wrecker\",\"2\":\"249\"},{\"1\":\"Tractor Truck Gasoline\",\"2\":\"241\"},{\"1\":\"Chassis Cab\",\"2\":\"161\"},{\"1\":\"Motorbike\",\"2\":\"160\"},{\"1\":\"MOPED\",\"2\":\"128\"},{\"1\":\"AMBULANCE\",\"2\":\"121\"},{\"1\":\"Tanker\",\"2\":\"112\"},{\"1\":\"subn\",\"2\":\"110\"},{\"1\":\"LIMO\",\"2\":\"81\"},{\"1\":\"Concrete Mixer\",\"2\":\"80\"},{\"1\":\"Flat Rack\",\"2\":\"65\"},{\"1\":\"3-Door\",\"2\":\"51\"},{\"1\":\"4 dr sedan\",\"2\":\"47\"},{\"1\":\"van\",\"2\":\"46\"},{\"1\":\"Refrigerated Van\",\"2\":\"43\"},{\"1\":\"Armored Truck\",\"2\":\"40\"},{\"1\":\"FIRE TRUCK\",\"2\":\"39\"},{\"1\":\"TRAILER\",\"2\":\"39\"},{\"1\":\"Beverage Truck\",\"2\":\"37\"},{\"1\":\"Pedicab\",\"2\":\"35\"},{\"1\":\"Truck\",\"2\":\"29\"},{\"1\":\"Trailer\",\"2\":\"28\"},{\"1\":\"Multi-Wheeled Vehicle\",\"2\":\"27\"},{\"1\":\"moped\",\"2\":\"27\"},{\"1\":\"UNK\",\"2\":\"26\"},{\"1\":\"FIRETRUCK\",\"2\":\"24\"},{\"1\":\"Open Body\",\"2\":\"24\"},{\"1\":\"Stake or Rack\",\"2\":\"24\"},{\"1\":\"SCOOTER\",\"2\":\"22\"},{\"1\":\"School Bus\",\"2\":\"21\"},{\"1\":\"Unknown\",\"2\":\"19\"},{\"1\":\"Lift Boom\",\"2\":\"18\"},{\"1\":\"Fire Truck\",\"2\":\"17\"},{\"1\":\"Fire truck\",\"2\":\"17\"},{\"1\":\"ambulance\",\"2\":\"17\"},{\"1\":\"Unk\",\"2\":\"16\"},{\"1\":\"UNKNOWN\",\"2\":\"15\"},{\"1\":\"Bulk Agriculture\",\"2\":\"14\"},{\"1\":\"Commercial\",\"2\":\"13\"},{\"1\":\"Tow Truck\",\"2\":\"13\"},{\"1\":\"COMMERCIAL\",\"2\":\"12\"},{\"1\":\"Minibike\",\"2\":\"12\"},{\"1\":\"Scooter\",\"2\":\"12\"},{\"1\":\"TOW TRUCK\",\"2\":\"12\"},{\"1\":\"FDNY AMBUL\",\"2\":\"11\"},{\"1\":\"FDNY FIRE\",\"2\":\"11\"},{\"1\":\"GARBAGE TR\",\"2\":\"11\"},{\"1\":\"PAS\",\"2\":\"11\"},{\"1\":\"SCHOOL BUS\",\"2\":\"11\"},{\"1\":\"AMBU\",\"2\":\"10\"},{\"1\":\"FORKLIFT\",\"2\":\"10\"},{\"1\":\"MTA BUS\",\"2\":\"10\"},{\"1\":\"TRUCK\",\"2\":\"10\"},{\"1\":\"BOX TRUCK\",\"2\":\"9\"},{\"1\":\"Box truck\",\"2\":\"9\"},{\"1\":\"FDNY TRUCK\",\"2\":\"9\"},{\"1\":\"Firetruck\",\"2\":\"9\"},{\"1\":\"pick\",\"2\":\"9\"},{\"1\":\"COM\",\"2\":\"8\"},{\"1\":\"FORK LIFT\",\"2\":\"8\"},{\"1\":\"Minicycle\",\"2\":\"8\"},{\"1\":\"Sanitation\",\"2\":\"8\"},{\"1\":\"bus\",\"2\":\"8\"},{\"1\":\"FDNY\",\"2\":\"7\"},{\"1\":\"Forklift\",\"2\":\"7\"},{\"1\":\"Pickup with mounted Camper\",\"2\":\"7\"},{\"1\":\"STREET SWE\",\"2\":\"7\"},{\"1\":\"ELECTRIC S\",\"2\":\"6\"},{\"1\":\"GAS SCOOTE\",\"2\":\"6\"},{\"1\":\"Lunch Wagon\",\"2\":\"6\"},{\"1\":\"MOTOR SCOO\",\"2\":\"6\"},{\"1\":\"PICK UP\",\"2\":\"6\"},{\"1\":\"PICK UP TR\",\"2\":\"6\"},{\"1\":\"Pallet\",\"2\":\"6\"},{\"1\":\"ROAD SWEEP\",\"2\":\"6\"},{\"1\":\"Snow Plow\",\"2\":\"6\"},{\"1\":\"VAN TRUCK\",\"2\":\"6\"},{\"1\":\"scooter\",\"2\":\"6\"},{\"1\":\"DUMP TRUCK\",\"2\":\"5\"},{\"1\":\"FDNY Ambul\",\"2\":\"5\"},{\"1\":\"FDNY FIRET\",\"2\":\"5\"},{\"1\":\"Motorized Home\",\"2\":\"5\"},{\"1\":\"PICKUP\",\"2\":\"5\"},{\"1\":\"RV\",\"2\":\"5\"},{\"1\":\"SANITATION\",\"2\":\"5\"},{\"1\":\"School bus\",\"2\":\"5\"},{\"1\":\"UTILITY TR\",\"2\":\"5\"},{\"1\":\"mcy\",\"2\":\"5\"},{\"1\":\"trailer\",\"2\":\"5\"},{\"1\":\"unknown\",\"2\":\"5\"},{\"1\":\"DELIVERY T\",\"2\":\"4\"},{\"1\":\"E-SCOOTER\",\"2\":\"4\"},{\"1\":\"FDNY truck\",\"2\":\"4\"},{\"1\":\"MC\",\"2\":\"4\"},{\"1\":\"PASSENGER\",\"2\":\"4\"},{\"1\":\"PICKUP TRU\",\"2\":\"4\"},{\"1\":\"Pick up tr\",\"2\":\"4\"},{\"1\":\"Pickup tru\",\"2\":\"4\"},{\"1\":\"Tractor tr\",\"2\":\"4\"},{\"1\":\"USPS\",\"2\":\"4\"},{\"1\":\"USPS TRUCK\",\"2\":\"4\"},{\"1\":\"Van Camper\",\"2\":\"4\"},{\"1\":\"CRANE\",\"2\":\"3\"},{\"1\":\"DELV\",\"2\":\"3\"},{\"1\":\"Dump truck\",\"2\":\"3\"},{\"1\":\"Excavator\",\"2\":\"3\"},{\"1\":\"Flatbed\",\"2\":\"3\"},{\"1\":\"GAS MOPED\",\"2\":\"3\"},{\"1\":\"GOLF CART\",\"2\":\"3\"},{\"1\":\"Garbage tr\",\"2\":\"3\"},{\"1\":\"Log\",\"2\":\"3\"},{\"1\":\"NYS AMBULA\",\"2\":\"3\"},{\"1\":\"PSD\",\"2\":\"3\"},{\"1\":\"Pickup\",\"2\":\"3\"},{\"1\":\"SPRINTER V\",\"2\":\"3\"},{\"1\":\"STAK\",\"2\":\"3\"},{\"1\":\"Sprinter v\",\"2\":\"3\"},{\"1\":\"Street Swe\",\"2\":\"3\"},{\"1\":\"Street swe\",\"2\":\"3\"},{\"1\":\"Subn\",\"2\":\"3\"},{\"1\":\"Tow truck\",\"2\":\"3\"},{\"1\":\"Tractor\",\"2\":\"3\"},{\"1\":\"UTIL\",\"2\":\"3\"},{\"1\":\"Unknown ve\",\"2\":\"3\"},{\"1\":\"Utility\",\"2\":\"3\"},{\"1\":\"WAGON\",\"2\":\"3\"},{\"1\":\"X COM\",\"2\":\"3\"},{\"1\":\"c1\",\"2\":\"3\"},{\"1\":\"e-bike\",\"2\":\"3\"},{\"1\":\"garbage tr\",\"2\":\"3\"},{\"1\":\"l1\",\"2\":\"3\"},{\"1\":\"school bus\",\"2\":\"3\"},{\"1\":\"taxi\",\"2\":\"3\"},{\"1\":\"tow truck\",\"2\":\"3\"},{\"1\":\"12 PASSENG\",\"2\":\"2\"},{\"1\":\"2 dr sedan\",\"2\":\"2\"},{\"1\":\"AMBULENCE\",\"2\":\"2\"},{\"1\":\"Ambulence\",\"2\":\"2\"},{\"1\":\"C\",\"2\":\"2\"},{\"1\":\"CARGO VAN\",\"2\":\"2\"},{\"1\":\"COMM VAN\",\"2\":\"2\"},{\"1\":\"Chevy\",\"2\":\"2\"},{\"1\":\"DUMP\",\"2\":\"2\"},{\"1\":\"Delivery\",\"2\":\"2\"},{\"1\":\"Delivery t\",\"2\":\"2\"},{\"1\":\"Dump Truck\",\"2\":\"2\"},{\"1\":\"E SCOOTER\",\"2\":\"2\"},{\"1\":\"E-BIKE\",\"2\":\"2\"},{\"1\":\"E-Unicycle\",\"2\":\"2\"},{\"1\":\"E-bike\",\"2\":\"2\"},{\"1\":\"EMS\",\"2\":\"2\"},{\"1\":\"Electric m\",\"2\":\"2\"},{\"1\":\"Electric s\",\"2\":\"2\"},{\"1\":\"FD AMBULAN\",\"2\":\"2\"},{\"1\":\"FDNY Truck\",\"2\":\"2\"},{\"1\":\"FIRE\",\"2\":\"2\"},{\"1\":\"FIRE ENGIN\",\"2\":\"2\"},{\"1\":\"FLAT BED T\",\"2\":\"2\"},{\"1\":\"FOOD CART\",\"2\":\"2\"},{\"1\":\"FORD\",\"2\":\"2\"},{\"1\":\"FREIGHT VA\",\"2\":\"2\"},{\"1\":\"Fork lift\",\"2\":\"2\"},{\"1\":\"Gas Moped\",\"2\":\"2\"},{\"1\":\"Gas Scoote\",\"2\":\"2\"},{\"1\":\"Gas scoote\",\"2\":\"2\"},{\"1\":\"Ladder tru\",\"2\":\"2\"},{\"1\":\"Lift\",\"2\":\"2\"},{\"1\":\"MOTORCYCLE\",\"2\":\"2\"},{\"1\":\"MOTORIZEDS\",\"2\":\"2\"},{\"1\":\"MTA Bus\",\"2\":\"2\"},{\"1\":\"Mail Truck\",\"2\":\"2\"},{\"1\":\"Minivan\",\"2\":\"2\"},{\"1\":\"Motor scoo\",\"2\":\"2\"},{\"1\":\"OMR\",\"2\":\"2\"},{\"1\":\"OMT\",\"2\":\"2\"},{\"1\":\"OTHER\",\"2\":\"2\"},{\"1\":\"Omnibus\",\"2\":\"2\"},{\"1\":\"PASSANGER\",\"2\":\"2\"},{\"1\":\"PEDICAB\",\"2\":\"2\"},{\"1\":\"POWER SHOV\",\"2\":\"2\"},{\"1\":\"Passenger\",\"2\":\"2\"},{\"1\":\"Pick Up Tr\",\"2\":\"2\"},{\"1\":\"Pick up\",\"2\":\"2\"},{\"1\":\"Pick up Tr\",\"2\":\"2\"},{\"1\":\"Pick-Up\",\"2\":\"2\"},{\"1\":\"Power Shov\",\"2\":\"2\"},{\"1\":\"REFG\",\"2\":\"2\"},{\"1\":\"RMP\",\"2\":\"2\"},{\"1\":\"Road sweep\",\"2\":\"2\"},{\"1\":\"SPC\",\"2\":\"2\"},{\"1\":\"SUBURBAN\",\"2\":\"2\"},{\"1\":\"SUV\",\"2\":\"2\"},{\"1\":\"Sprinter V\",\"2\":\"2\"},{\"1\":\"TRACTOR\",\"2\":\"2\"},{\"1\":\"TRANSPORT\",\"2\":\"2\"},{\"1\":\"Tow\",\"2\":\"2\"},{\"1\":\"UPS TRUCK\",\"2\":\"2\"},{\"1\":\"USPS Truck\",\"2\":\"2\"},{\"1\":\"UTILITY\",\"2\":\"2\"},{\"1\":\"UTILITY VE\",\"2\":\"2\"},{\"1\":\"Van Truck\",\"2\":\"2\"},{\"1\":\"WHITE VAN\",\"2\":\"2\"},{\"1\":\"c3\",\"2\":\"2\"},{\"1\":\"f1\",\"2\":\"2\"},{\"1\":\"fdny truck\",\"2\":\"2\"},{\"1\":\"fire truck\",\"2\":\"2\"},{\"1\":\"fork lift\",\"2\":\"2\"},{\"1\":\"mta bus\",\"2\":\"2\"},{\"1\":\"pick up\",\"2\":\"2\"},{\"1\":\"pick up tr\",\"2\":\"2\"},{\"1\":\"skateboard\",\"2\":\"2\"},{\"1\":\"street swe\",\"2\":\"2\"},{\"1\":\"toyot\",\"2\":\"2\"},{\"1\":\"tr\",\"2\":\"2\"},{\"1\":\"truck\",\"2\":\"2\"},{\"1\":\"utility tr\",\"2\":\"2\"},{\"1\":\"utility ve\",\"2\":\"2\"},{\"1\":\"wheelchair\",\"2\":\"2\"},{\"1\":\"13\",\"2\":\"1\"},{\"1\":\"17\",\"2\":\"1\"},{\"1\":\"18 WHEELER\",\"2\":\"1\"},{\"1\":\"2YDSWHEELL\",\"2\":\"1\"},{\"1\":\"4 wheeler\",\"2\":\"1\"},{\"1\":\"4dsd\",\"2\":\"1\"},{\"1\":\"787\",\"2\":\"1\"},{\"1\":\"A\",\"2\":\"1\"},{\"1\":\"A bulance\",\"2\":\"1\"},{\"1\":\"ABMU\",\"2\":\"1\"},{\"1\":\"ACUR\",\"2\":\"1\"},{\"1\":\"AMAZON VAN\",\"2\":\"1\"},{\"1\":\"AMB\",\"2\":\"1\"},{\"1\":\"AMBALANCE\",\"2\":\"1\"},{\"1\":\"AMBLUANCE\",\"2\":\"1\"},{\"1\":\"AMBULANVE\",\"2\":\"1\"},{\"1\":\"AMULANCE\",\"2\":\"1\"},{\"1\":\"Amb\",\"2\":\"1\"},{\"1\":\"Ambu\",\"2\":\"1\"},{\"1\":\"BEYOND SCO\",\"2\":\"1\"},{\"1\":\"BOBCAT\",\"2\":\"1\"},{\"1\":\"BOBCAT/FOR\",\"2\":\"1\"},{\"1\":\"BOOM LIFT\",\"2\":\"1\"},{\"1\":\"BOOM MOPED\",\"2\":\"1\"},{\"1\":\"BOX CAR\",\"2\":\"1\"},{\"1\":\"BOX VAN\",\"2\":\"1\"},{\"1\":\"BOXTRUCK\",\"2\":\"1\"},{\"1\":\"BUS (OMNIB\",\"2\":\"1\"},{\"1\":\"Backhoe\",\"2\":\"1\"},{\"1\":\"Backhoe Lo\",\"2\":\"1\"},{\"1\":\"Boom Lift\",\"2\":\"1\"},{\"1\":\"Box Car\",\"2\":\"1\"},{\"1\":\"Box Mail t\",\"2\":\"1\"},{\"1\":\"Bread truc\",\"2\":\"1\"},{\"1\":\"Bucket tru\",\"2\":\"1\"},{\"1\":\"Bull dozer\",\"2\":\"1\"},{\"1\":\"Bulldozer\",\"2\":\"1\"},{\"1\":\"C1\",\"2\":\"1\"},{\"1\":\"C2\",\"2\":\"1\"},{\"1\":\"C3\",\"2\":\"1\"},{\"1\":\"C40\",\"2\":\"1\"},{\"1\":\"C45 BOC TR\",\"2\":\"1\"},{\"1\":\"CAN\",\"2\":\"1\"},{\"1\":\"CAR/SUV\",\"2\":\"1\"},{\"1\":\"CARAVAN\",\"2\":\"1\"},{\"1\":\"CEMENT MIX\",\"2\":\"1\"},{\"1\":\"CHEVY VAN\",\"2\":\"1\"},{\"1\":\"COMMERICIA\",\"2\":\"1\"},{\"1\":\"CONSTRUCTI\",\"2\":\"1\"},{\"1\":\"Car Traile\",\"2\":\"1\"},{\"1\":\"Cargo van\",\"2\":\"1\"},{\"1\":\"Carrier\",\"2\":\"1\"},{\"1\":\"Com\",\"2\":\"1\"},{\"1\":\"Courier\",\"2\":\"1\"},{\"1\":\"Crane\",\"2\":\"1\"},{\"1\":\"D3\",\"2\":\"1\"},{\"1\":\"DELIVERY\",\"2\":\"1\"},{\"1\":\"DELV WH\",\"2\":\"1\"},{\"1\":\"DIRTBIKE\",\"2\":\"1\"},{\"1\":\"DOT\",\"2\":\"1\"},{\"1\":\"DOT Safety\",\"2\":\"1\"},{\"1\":\"DOT TOW TR\",\"2\":\"1\"},{\"1\":\"DOT TRUCK\",\"2\":\"1\"},{\"1\":\"DOT VEHICL\",\"2\":\"1\"},{\"1\":\"DSNY Garba\",\"2\":\"1\"},{\"1\":\"Department\",\"2\":\"1\"},{\"1\":\"Dodge ram\",\"2\":\"1\"},{\"1\":\"Dumpster t\",\"2\":\"1\"},{\"1\":\"E MOTORCYC\",\"2\":\"1\"},{\"1\":\"E-SKATEBOA\",\"2\":\"1\"},{\"1\":\"E-scooter\",\"2\":\"1\"},{\"1\":\"EBIKE\",\"2\":\"1\"},{\"1\":\"ELECTRIC C\",\"2\":\"1\"},{\"1\":\"ELECTRIC M\",\"2\":\"1\"},{\"1\":\"EMI- TRAIL\",\"2\":\"1\"},{\"1\":\"EMS AMBULA\",\"2\":\"1\"},{\"1\":\"EMT Ambula\",\"2\":\"1\"},{\"1\":\"ESCOOTER\",\"2\":\"1\"},{\"1\":\"EXCABATOR\",\"2\":\"1\"},{\"1\":\"EXCAVATOR\",\"2\":\"1\"},{\"1\":\"Ele. Unicy\",\"2\":\"1\"},{\"1\":\"Electric M\",\"2\":\"1\"},{\"1\":\"Electric S\",\"2\":\"1\"},{\"1\":\"Electrict\",\"2\":\"1\"},{\"1\":\"Electricun\",\"2\":\"1\"},{\"1\":\"Ems truck\",\"2\":\"1\"},{\"1\":\"Enclosed Body - Nonremovable Enclosure\",\"2\":\"1\"},{\"1\":\"Enclosed Body - Removable Enclosure\",\"2\":\"1\"},{\"1\":\"F550\",\"2\":\"1\"},{\"1\":\"FD Pickup\",\"2\":\"1\"},{\"1\":\"FDNY ENGIN\",\"2\":\"1\"},{\"1\":\"FDNY Ferra\",\"2\":\"1\"},{\"1\":\"FDNY Fire\",\"2\":\"1\"},{\"1\":\"FDNY LADDE\",\"2\":\"1\"},{\"1\":\"FDNY SP200\",\"2\":\"1\"},{\"1\":\"FDNY SUPER\",\"2\":\"1\"},{\"1\":\"FDNY UTILI\",\"2\":\"1\"},{\"1\":\"FDNY Vehic\",\"2\":\"1\"},{\"1\":\"FDNY firet\",\"2\":\"1\"},{\"1\":\"FDNY mecha\",\"2\":\"1\"},{\"1\":\"FDNY- Fire\",\"2\":\"1\"},{\"1\":\"FDNY285 En\",\"2\":\"1\"},{\"1\":\"FLAT\",\"2\":\"1\"},{\"1\":\"FLYWING MO\",\"2\":\"1\"},{\"1\":\"FOGLIFT\",\"2\":\"1\"},{\"1\":\"FOOD TRUCK\",\"2\":\"1\"},{\"1\":\"FORD AMBUL\",\"2\":\"1\"},{\"1\":\"FORD F-150\",\"2\":\"1\"},{\"1\":\"FORD SUPER\",\"2\":\"1\"},{\"1\":\"FORD TWO T\",\"2\":\"1\"},{\"1\":\"FORD-TCN\",\"2\":\"1\"},{\"1\":\"FREIGHT LI\",\"2\":\"1\"},{\"1\":\"FREIGHTLIN\",\"2\":\"1\"},{\"1\":\"FRHT VEHIC\",\"2\":\"1\"},{\"1\":\"FRHT-SPR\",\"2\":\"1\"},{\"1\":\"Fdny\",\"2\":\"1\"},{\"1\":\"Fdny 331 k\",\"2\":\"1\"},{\"1\":\"Fdny Fire\",\"2\":\"1\"},{\"1\":\"Fdny fire\",\"2\":\"1\"},{\"1\":\"Fdny truck\",\"2\":\"1\"},{\"1\":\"Fed Ex Van\",\"2\":\"1\"},{\"1\":\"FedEx Truc\",\"2\":\"1\"},{\"1\":\"Fedex truc\",\"2\":\"1\"},{\"1\":\"Fire Engin\",\"2\":\"1\"},{\"1\":\"Fire engin\",\"2\":\"1\"},{\"1\":\"FireTruck\",\"2\":\"1\"},{\"1\":\"Flywing\",\"2\":\"1\"},{\"1\":\"Food Cart\",\"2\":\"1\"},{\"1\":\"Ford\",\"2\":\"1\"},{\"1\":\"Ford Couri\",\"2\":\"1\"},{\"1\":\"Ford FF\",\"2\":\"1\"},{\"1\":\"Ford Trans\",\"2\":\"1\"},{\"1\":\"Ford f150\",\"2\":\"1\"},{\"1\":\"Freight Va\",\"2\":\"1\"},{\"1\":\"G   SCL\",\"2\":\"1\"},{\"1\":\"GAS PWR SC\",\"2\":\"1\"},{\"1\":\"GEICO\",\"2\":\"1\"},{\"1\":\"GOLFCART\",\"2\":\"1\"},{\"1\":\"GOVENMENT\",\"2\":\"1\"},{\"1\":\"GSPC\",\"2\":\"1\"},{\"1\":\"GTH-1056\",\"2\":\"1\"},{\"1\":\"Garbage Tr\",\"2\":\"1\"},{\"1\":\"Golf cart\",\"2\":\"1\"},{\"1\":\"Government\",\"2\":\"1\"},{\"1\":\"Govt P/U T\",\"2\":\"1\"},{\"1\":\"Grumman LL\",\"2\":\"1\"},{\"1\":\"HEAVY TRUC\",\"2\":\"1\"},{\"1\":\"HORSE DRAW\",\"2\":\"1\"},{\"1\":\"HORSE TRAI\",\"2\":\"1\"},{\"1\":\"HOUSE ON W\",\"2\":\"1\"},{\"1\":\"HURSE\",\"2\":\"1\"},{\"1\":\"Hopper\",\"2\":\"1\"},{\"1\":\"Horse Carr\",\"2\":\"1\"},{\"1\":\"I1\",\"2\":\"1\"},{\"1\":\"JEEP\",\"2\":\"1\"},{\"1\":\"JJ150T-4A\",\"2\":\"1\"},{\"1\":\"JLG ULTRA\",\"2\":\"1\"},{\"1\":\"JOHND\",\"2\":\"1\"},{\"1\":\"KME\",\"2\":\"1\"},{\"1\":\"LAWNMOWER\",\"2\":\"1\"},{\"1\":\"LIABITIY\",\"2\":\"1\"},{\"1\":\"LSV\",\"2\":\"1\"},{\"1\":\"LTR\",\"2\":\"1\"},{\"1\":\"Ladder\",\"2\":\"1\"},{\"1\":\"Lim\",\"2\":\"1\"},{\"1\":\"Limo\",\"2\":\"1\"},{\"1\":\"M/C\",\"2\":\"1\"},{\"1\":\"MACK\",\"2\":\"1\"},{\"1\":\"MACK TRUCK\",\"2\":\"1\"},{\"1\":\"MANUAL SCO\",\"2\":\"1\"},{\"1\":\"MARKED RMP\",\"2\":\"1\"},{\"1\":\"MECHANICAL\",\"2\":\"1\"},{\"1\":\"METRO TRAN\",\"2\":\"1\"},{\"1\":\"METROTECH\",\"2\":\"1\"},{\"1\":\"MILITARY\",\"2\":\"1\"},{\"1\":\"MINI VAHN\",\"2\":\"1\"},{\"1\":\"MINI VAN\",\"2\":\"1\"},{\"1\":\"MOOPER\",\"2\":\"1\"},{\"1\":\"MOPD\",\"2\":\"1\"},{\"1\":\"MOPED CLAS\",\"2\":\"1\"},{\"1\":\"MOPED GAS\",\"2\":\"1\"},{\"1\":\"MOPPED\",\"2\":\"1\"},{\"1\":\"MOTO-SCOOT\",\"2\":\"1\"},{\"1\":\"MOTOR. SCO\",\"2\":\"1\"},{\"1\":\"MOTORHOME\",\"2\":\"1\"},{\"1\":\"MOTORIZED\",\"2\":\"1\"},{\"1\":\"MOVING VAN\",\"2\":\"1\"},{\"1\":\"MTA\",\"2\":\"1\"},{\"1\":\"MTA ESU VE\",\"2\":\"1\"},{\"1\":\"MTA TRANSI\",\"2\":\"1\"},{\"1\":\"MTA transi\",\"2\":\"1\"},{\"1\":\"Mack truck\",\"2\":\"1\"},{\"1\":\"ManPower s\",\"2\":\"1\"},{\"1\":\"Mcy\",\"2\":\"1\"},{\"1\":\"Military v\",\"2\":\"1\"},{\"1\":\"Mopad\",\"2\":\"1\"},{\"1\":\"Motor Scoo\",\"2\":\"1\"},{\"1\":\"Motorized\",\"2\":\"1\"},{\"1\":\"Mta bus\",\"2\":\"1\"},{\"1\":\"N/A\",\"2\":\"1\"},{\"1\":\"NE/FL\",\"2\":\"1\"},{\"1\":\"NYC AMBULA\",\"2\":\"1\"},{\"1\":\"NYC FDNY #\",\"2\":\"1\"},{\"1\":\"NYC FIRE T\",\"2\":\"1\"},{\"1\":\"NYC SANITA\",\"2\":\"1\"},{\"1\":\"NYC TRANSI\",\"2\":\"1\"},{\"1\":\"NYCHA FORK\",\"2\":\"1\"},{\"1\":\"NYPD Tow t\",\"2\":\"1\"},{\"1\":\"OMS\",\"2\":\"1\"},{\"1\":\"P PSD\",\"2\":\"1\"},{\"1\":\"P/SH YW\",\"2\":\"1\"},{\"1\":\"P/U\",\"2\":\"1\"},{\"1\":\"PASS VAN\",\"2\":\"1\"},{\"1\":\"PEDAL BIKE\",\"2\":\"1\"},{\"1\":\"PENSKE BOX\",\"2\":\"1\"},{\"1\":\"PICK-UP\",\"2\":\"1\"},{\"1\":\"PKUP\",\"2\":\"1\"},{\"1\":\"POLICE VEH\",\"2\":\"1\"},{\"1\":\"POSTAL tru\",\"2\":\"1\"},{\"1\":\"POSTOFFICE\",\"2\":\"1\"},{\"1\":\"PROGRESSIV\",\"2\":\"1\"},{\"1\":\"Pickup SL\",\"2\":\"1\"},{\"1\":\"Pickup tow\",\"2\":\"1\"},{\"1\":\"Postal Tru\",\"2\":\"1\"},{\"1\":\"Power shov\",\"2\":\"1\"},{\"1\":\"Private Am\",\"2\":\"1\"},{\"1\":\"RAM\",\"2\":\"1\"},{\"1\":\"RAM COMM.\",\"2\":\"1\"},{\"1\":\"REAR END\",\"2\":\"1\"},{\"1\":\"RED\",\"2\":\"1\"},{\"1\":\"REF BOX TR\",\"2\":\"1\"},{\"1\":\"REG\",\"2\":\"1\"},{\"1\":\"REVEL MOPE\",\"2\":\"1\"},{\"1\":\"REVEL SCOO\",\"2\":\"1\"},{\"1\":\"ROLLOFF\",\"2\":\"1\"},{\"1\":\"RV motorho\",\"2\":\"1\"},{\"1\":\"Razor Scoo\",\"2\":\"1\"},{\"1\":\"Rds\",\"2\":\"1\"},{\"1\":\"Ridgeline\",\"2\":\"1\"},{\"1\":\"Rmp\",\"2\":\"1\"},{\"1\":\"Road Sweep\",\"2\":\"1\"},{\"1\":\"SALTSPREAD\",\"2\":\"1\"},{\"1\":\"SCHOOL  BU\",\"2\":\"1\"},{\"1\":\"SCHOOLBUS\",\"2\":\"1\"},{\"1\":\"SCOOTER (G\",\"2\":\"1\"},{\"1\":\"SCOOTER SI\",\"2\":\"1\"},{\"1\":\"SCOOTER/MO\",\"2\":\"1\"},{\"1\":\"SEDAN\",\"2\":\"1\"},{\"1\":\"SELF INSUR\",\"2\":\"1\"},{\"1\":\"SEMI\",\"2\":\"1\"},{\"1\":\"SEMI-TRUCK\",\"2\":\"1\"},{\"1\":\"SEMITRAILE\",\"2\":\"1\"},{\"1\":\"SKATEBOARD\",\"2\":\"1\"},{\"1\":\"SPRINTER\",\"2\":\"1\"},{\"1\":\"STAND UP S\",\"2\":\"1\"},{\"1\":\"STAND UP s\",\"2\":\"1\"},{\"1\":\"STREET CLE\",\"2\":\"1\"},{\"1\":\"Scooter ga\",\"2\":\"1\"},{\"1\":\"Scooter/Mo\",\"2\":\"1\"},{\"1\":\"Seagrave T\",\"2\":\"1\"},{\"1\":\"Siting mop\",\"2\":\"1\"},{\"1\":\"Skateboard\",\"2\":\"1\"},{\"1\":\"Small Bus\",\"2\":\"1\"},{\"1\":\"Spc\",\"2\":\"1\"},{\"1\":\"Sprinter\",\"2\":\"1\"},{\"1\":\"Subn/ambul\",\"2\":\"1\"},{\"1\":\"Suburban\",\"2\":\"1\"},{\"1\":\"TF\",\"2\":\"1\"},{\"1\":\"TL\",\"2\":\"1\"},{\"1\":\"TL TRAILER\",\"2\":\"1\"},{\"1\":\"TOW-TRUCK\",\"2\":\"1\"},{\"1\":\"TRAC\",\"2\":\"1\"},{\"1\":\"TRACTOR TR\",\"2\":\"1\"},{\"1\":\"TRAILER/TR\",\"2\":\"1\"},{\"1\":\"Tank\",\"2\":\"1\"},{\"1\":\"Tank truck\",\"2\":\"1\"},{\"1\":\"Telehandle\",\"2\":\"1\"},{\"1\":\"Tk\",\"2\":\"1\"},{\"1\":\"Tracktor T\",\"2\":\"1\"},{\"1\":\"Tractor Tr\",\"2\":\"1\"},{\"1\":\"Traffic To\",\"2\":\"1\"},{\"1\":\"Trailer Fl\",\"2\":\"1\"},{\"1\":\"Trailor\",\"2\":\"1\"},{\"1\":\"Transit va\",\"2\":\"1\"},{\"1\":\"U HAUL\",\"2\":\"1\"},{\"1\":\"U haul tra\",\"2\":\"1\"},{\"1\":\"UHAUL\",\"2\":\"1\"},{\"1\":\"UHAUL TRAI\",\"2\":\"1\"},{\"1\":\"UHal Renta\",\"2\":\"1\"},{\"1\":\"UKNOWN\",\"2\":\"1\"},{\"1\":\"UNKN\",\"2\":\"1\"},{\"1\":\"UNKNOWN CA\",\"2\":\"1\"},{\"1\":\"UNKOWM\",\"2\":\"1\"},{\"1\":\"UNKOWN\",\"2\":\"1\"},{\"1\":\"UNKWOWN\",\"2\":\"1\"},{\"1\":\"UPS Truck\",\"2\":\"1\"},{\"1\":\"UPS VAN\",\"2\":\"1\"},{\"1\":\"UPS truck\",\"2\":\"1\"},{\"1\":\"US Postal\",\"2\":\"1\"},{\"1\":\"USPS #6530\",\"2\":\"1\"},{\"1\":\"USPS MAIL\",\"2\":\"1\"},{\"1\":\"USPS Post\",\"2\":\"1\"},{\"1\":\"USPS VAN\",\"2\":\"1\"},{\"1\":\"USPS VEHIC\",\"2\":\"1\"},{\"1\":\"Usps truck\",\"2\":\"1\"},{\"1\":\"Utility Ve\",\"2\":\"1\"},{\"1\":\"Utility tr\",\"2\":\"1\"},{\"1\":\"Utility ve\",\"2\":\"1\"},{\"1\":\"VA\",\"2\":\"1\"},{\"1\":\"VAN (TRANS\",\"2\":\"1\"},{\"1\":\"VAn\",\"2\":\"1\"},{\"1\":\"VENDOR FOO\",\"2\":\"1\"},{\"1\":\"VESPA\",\"2\":\"1\"},{\"1\":\"Van (Trans\",\"2\":\"1\"},{\"1\":\"Van truck\",\"2\":\"1\"},{\"1\":\"Van/Truck\",\"2\":\"1\"},{\"1\":\"Vanette\",\"2\":\"1\"},{\"1\":\"WHEELCHAIR\",\"2\":\"1\"},{\"1\":\"WSTR\",\"2\":\"1\"},{\"1\":\"Waste truc\",\"2\":\"1\"},{\"1\":\"Well Driller\",\"2\":\"1\"},{\"1\":\"White Ford\",\"2\":\"1\"},{\"1\":\"White Work\",\"2\":\"1\"},{\"1\":\"Workcart\",\"2\":\"1\"},{\"1\":\"X Amb\",\"2\":\"1\"},{\"1\":\"YELLOW BUS\",\"2\":\"1\"},{\"1\":\"Yale Fork\",\"2\":\"1\"},{\"1\":\"Yellow bus\",\"2\":\"1\"},{\"1\":\"a\",\"2\":\"1\"},{\"1\":\"access-a-r\",\"2\":\"1\"},{\"1\":\"amazon tru\",\"2\":\"1\"},{\"1\":\"ambu\",\"2\":\"1\"},{\"1\":\"black\",\"2\":\"1\"},{\"1\":\"black mope\",\"2\":\"1\"},{\"1\":\"box truck\",\"2\":\"1\"},{\"1\":\"box van\",\"2\":\"1\"},{\"1\":\"camper\",\"2\":\"1\"},{\"1\":\"cart\",\"2\":\"1\"},{\"1\":\"chev\",\"2\":\"1\"},{\"1\":\"com\",\"2\":\"1\"},{\"1\":\"commercial\",\"2\":\"1\"},{\"1\":\"commerial\",\"2\":\"1\"},{\"1\":\"commerical\",\"2\":\"1\"},{\"1\":\"d3\",\"2\":\"1\"},{\"1\":\"del truck\",\"2\":\"1\"},{\"1\":\"delivery t\",\"2\":\"1\"},{\"1\":\"delv\",\"2\":\"1\"},{\"1\":\"derelict v\",\"2\":\"1\"},{\"1\":\"dirt bike\",\"2\":\"1\"},{\"1\":\"e scooter\",\"2\":\"1\"},{\"1\":\"e-scooter\",\"2\":\"1\"},{\"1\":\"electric s\",\"2\":\"1\"},{\"1\":\"ems bus\",\"2\":\"1\"},{\"1\":\"escooter\",\"2\":\"1\"},{\"1\":\"f\",\"2\":\"1\"},{\"1\":\"fdny fire\",\"2\":\"1\"},{\"1\":\"firetruck\",\"2\":\"1\"},{\"1\":\"ford trans\",\"2\":\"1\"},{\"1\":\"forklift\",\"2\":\"1\"},{\"1\":\"gas moped\",\"2\":\"1\"},{\"1\":\"mini bus\",\"2\":\"1\"},{\"1\":\"motor scoo\",\"2\":\"1\"},{\"1\":\"motorcycle\",\"2\":\"1\"},{\"1\":\"nissa\",\"2\":\"1\"},{\"1\":\"pass\",\"2\":\"1\"},{\"1\":\"pickup tow\",\"2\":\"1\"},{\"1\":\"pickup tru\",\"2\":\"1\"},{\"1\":\"police van\",\"2\":\"1\"},{\"1\":\"power shov\",\"2\":\"1\"},{\"1\":\"push scoot\",\"2\":\"1\"},{\"1\":\"refg\",\"2\":\"1\"},{\"1\":\"rgs\",\"2\":\"1\"},{\"1\":\"sprinter v\",\"2\":\"1\"},{\"1\":\"standing s\",\"2\":\"1\"},{\"1\":\"sub\",\"2\":\"1\"},{\"1\":\"subar\",\"2\":\"1\"},{\"1\":\"tow\",\"2\":\"1\"},{\"1\":\"tractor tr\",\"2\":\"1\"},{\"1\":\"u haul\",\"2\":\"1\"},{\"1\":\"usps truck\",\"2\":\"1\"},{\"1\":\"utv bobcat\",\"2\":\"1\"},{\"1\":\"wag\",\"2\":\"1\"},{\"1\":\"wagon\",\"2\":\"1\"},{\"1\":\"work van\",\"2\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ncount(vehicle_dat, Contributing_factor, sort = TRUE)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Contributing_factor\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Unspecified\",\"2\":\"85757\"},{\"1\":\"Driver Inattention/Distraction\",\"2\":\"28025\"},{\"1\":\"Following Too Closely\",\"2\":\"7423\"},{\"1\":\"Failure to Yield Right-of-Way\",\"2\":\"6953\"},{\"1\":\"Passing or Lane Usage Improper\",\"2\":\"4984\"},{\"1\":\"Unsafe Speed\",\"2\":\"4325\"},{\"1\":\"Other Vehicular\",\"2\":\"4153\"},{\"1\":\"Passing Too Closely\",\"2\":\"3590\"},{\"1\":\"Traffic Control Disregarded\",\"2\":\"3382\"},{\"1\":\"Backing Unsafely\",\"2\":\"2973\"},{\"1\":\"Turning Improperly\",\"2\":\"2434\"},{\"1\":\"Driver Inexperience\",\"2\":\"2356\"},{\"1\":\"Unsafe Lane Changing\",\"2\":\"2149\"},{\"1\":\"Alcohol Involvement\",\"2\":\"1861\"},{\"1\":\"Reaction to Uninvolved Vehicle\",\"2\":\"1283\"},{\"1\":\"Pedestrian/Bicyclist/Other Pedestrian Error/Confusion\",\"2\":\"1268\"},{\"1\":\"View Obstructed/Limited\",\"2\":\"1010\"},{\"1\":\"Aggressive Driving/Road Rage\",\"2\":\"936\"},{\"1\":\"Pavement Slippery\",\"2\":\"671\"},{\"1\":\"Fell Asleep\",\"2\":\"459\"},{\"1\":\"Oversized Vehicle\",\"2\":\"443\"},{\"1\":\"Brakes Defective\",\"2\":\"396\"},{\"1\":\"Passenger Distraction\",\"2\":\"301\"},{\"1\":\"Outside Car Distraction\",\"2\":\"281\"},{\"1\":\"Obstruction/Debris\",\"2\":\"238\"},{\"1\":\"Steering Failure\",\"2\":\"213\"},{\"1\":\"Lost Consciousness\",\"2\":\"207\"},{\"1\":\"Illnes\",\"2\":\"184\"},{\"1\":\"Tire Failure/Inadequate\",\"2\":\"161\"},{\"1\":\"Glare\",\"2\":\"139\"},{\"1\":\"Failure to Keep Right\",\"2\":\"138\"},{\"1\":\"Driverless/Runaway Vehicle\",\"2\":\"106\"},{\"1\":\"Fatigued/Drowsy\",\"2\":\"93\"},{\"1\":\"Pavement Defective\",\"2\":\"90\"},{\"1\":\"Drugs (illegal)\",\"2\":\"81\"},{\"1\":\"Animals Action\",\"2\":\"79\"},{\"1\":\"Accelerator Defective\",\"2\":\"65\"},{\"1\":\"Traffic Control Device Improper/Non-Working\",\"2\":\"53\"},{\"1\":\"Cell Phone (hand-Held)\",\"2\":\"43\"},{\"1\":\"Lane Marking Improper/Inadequate\",\"2\":\"41\"},{\"1\":\"Physical Disability\",\"2\":\"34\"},{\"1\":\"Tinted Windows\",\"2\":\"26\"},{\"1\":\"Prescription Medication\",\"2\":\"20\"},{\"1\":\"Tow Hitch Defective\",\"2\":\"15\"},{\"1\":\"Vehicle Vandalism\",\"2\":\"15\"},{\"1\":\"Headlights Defective\",\"2\":\"10\"},{\"1\":\"Other Electronic Device\",\"2\":\"10\"},{\"1\":\"Other Lighting Defects\",\"2\":\"9\"},{\"1\":\"Eating or Drinking\",\"2\":\"8\"},{\"1\":\"Using On Board Navigation Device\",\"2\":\"8\"},{\"1\":\"Cell Phone (hands-free)\",\"2\":\"4\"},{\"1\":\"Shoulders Defective/Improper\",\"2\":\"3\"},{\"1\":\"Texting\",\"2\":\"3\"},{\"1\":\"Windshield Inadequate\",\"2\":\"3\"},{\"1\":\"Listening/Using Headphones\",\"2\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nThere are a _lot_ of categories in here, and many of them appear to overlap (e.g., \"Motorcycle\" and \"Motorbike\"). To clean up a bit, we'll change all `Type_code` entries to sentence case, then manually consolidate some levels:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvehicle_dat <- vehicle_dat %>% \n  mutate(Type_code = str_to_sentence(Type_code),\n         Type_code = case_when( # checks a series of conditionals\n           str_detect(Type_code, \n                      coll(\"wagon\", ignore_case = TRUE)) ~ \"SUV/station wagon\",\n           str_detect(Type_code, \n                      coll(\"sedan\",ignore_case = TRUE)) ~ \"Sedan\",\n           .default = Type_code),\n         Type_code = case_match( # Replaces (vectors of) matches, OLD ~ NEW\n           Type_code,\n           \"Bicycle\" ~ \"Bike\",\n           \"Motorbike\" ~ \"Motorcycle\",\n           c(\"Ambul\",\"Ambu\",\"Amb\") ~ \"Ambulance\",\n           c(\"Unkno\",\"Unk\") ~ \"Unknown\",\n           c(\"Fire\",\"Fdny\",\"Firetruck\",\n             \"Firet\",\"Fdny truck\",\"Fdny fire\") ~ \"Fire truck\",\n           \"E-sco\" ~ \"E-scooter\",\n           \"E-bik\" ~ \"E-bike\",\n           .default = Type_code) %>% \n           fct_lump_prop(0.005), # Lump codes occurring less than 0.5% \n         Contributing_factor = fct_lump_prop(\n           str_to_sentence(Contributing_factor), \n           0.005)) # same for contributing factor\n```\n:::\n\n\nNow let's check our work:\n\n\n::: {#tbl-incidents-by-vehicle-type-factor .cell tbl-cap='Incidents by vehicle type and contributing factor'}\n\n```{.r .cell-code}\n(crashes_by_type <- count(vehicle_dat, Type_code, \n                          sort = TRUE, name = \"Crashes\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Type_code\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Crashes\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Sedan\",\"2\":\"74602\"},{\"1\":\"SUV/station wagon\",\"2\":\"57246\"},{\"1\":\"Bike\",\"2\":\"5444\"},{\"1\":\"Other\",\"2\":\"5395\"},{\"1\":\"Pick-up truck\",\"2\":\"4189\"},{\"1\":\"Taxi\",\"2\":\"3790\"},{\"1\":\"Box truck\",\"2\":\"3674\"},{\"1\":\"Bus\",\"2\":\"3432\"},{\"1\":\"E-bike\",\"2\":\"2553\"},{\"1\":\"Motorcycle\",\"2\":\"2182\"},{\"1\":\"Moped\",\"2\":\"1856\"},{\"1\":\"E-scooter\",\"2\":\"1524\"},{\"1\":\"Tractor truck diesel\",\"2\":\"1369\"},{\"1\":\"Van\",\"2\":\"1163\"},{\"1\":\"Ambulance\",\"2\":\"1094\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n(crashes_by_factor <- count(vehicle_dat, Contributing_factor, \n                            sort = TRUE, name = \"Crashes\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Contributing_factor\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"Crashes\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Unspecified\",\"2\":\"85757\"},{\"1\":\"Driver inattention/distraction\",\"2\":\"28025\"},{\"1\":\"Following too closely\",\"2\":\"7423\"},{\"1\":\"Failure to yield right-of-way\",\"2\":\"6953\"},{\"1\":\"Passing or lane usage improper\",\"2\":\"4984\"},{\"1\":\"Other\",\"2\":\"4651\"},{\"1\":\"Unsafe speed\",\"2\":\"4325\"},{\"1\":\"Other vehicular\",\"2\":\"4153\"},{\"1\":\"Passing too closely\",\"2\":\"3590\"},{\"1\":\"Traffic control disregarded\",\"2\":\"3382\"},{\"1\":\"Backing unsafely\",\"2\":\"2973\"},{\"1\":\"Turning improperly\",\"2\":\"2434\"},{\"1\":\"Driver inexperience\",\"2\":\"2356\"},{\"1\":\"Unsafe lane changing\",\"2\":\"2149\"},{\"1\":\"Alcohol involvement\",\"2\":\"1861\"},{\"1\":\"Reaction to uninvolved vehicle\",\"2\":\"1283\"},{\"1\":\"Pedestrian/bicyclist/other pedestrian error/confusion\",\"2\":\"1268\"},{\"1\":\"View obstructed/limited\",\"2\":\"1010\"},{\"1\":\"Aggressive driving/road rage\",\"2\":\"936\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nIt's not perfect, and a subject matter expert could probably identify more types/factors that could be combined, but it should be workable for our purposes.\n\n### Exploring\n\n#### What types of vehicles were involved in crashes?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crashes_by_type, aes(x = fct_rev(fct_inorder(Type_code)), y = Crashes)) + \n  geom_col() + coord_flip() +\n  labs(x = \"Vehicle type\")\n```\n\n::: {.cell-output-display}\n![Incidents by vehicle type](index_files/figure-html/fig-incidents-by-vehicle-type-1.png){#fig-incidents-by-vehicle-type width=672}\n:::\n:::\n\n\nWithout knowing more about how common different types of vehicles are in NYC, we can't make strong inferences from this data; i.e., the prevalence of sedans, SUVs, and station wagons in the crash data likely reflects the prevalence of these vehicles on the road, period. If we wanted to explore whether certain vehicle types are disproportionately likely to be involved in crashes, we'd need to know not just how many of each vehicle type are present in the city, but also how many hours each vehicle type is in motion on average (since, for example, buses and box trucks probably spend more of their time driving than private passenger vehicles, even if there are more of the latter).\n\n#### What contributing factors were involved in crashes?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrashes_by_factor %>% \n  filter(Contributing_factor != \"Unspecified\") %>% # Ignore missing data\n  ggplot(aes(x = fct_rev(fct_inorder(Contributing_factor)), y = Crashes)) + \n  geom_col() + coord_flip() +\n  labs(x = \"Contributing factor\")\n```\n\n::: {.cell-output-display}\n![Incidents by contributing factor](index_files/figure-html/fig-incidents-by-factor-1.png){#fig-incidents-by-factor width=672}\n:::\n:::\n\n\nHere, we can draw more inferences from the data alone. Distracted driving seems to be a clear issue, as well as following too closely and failing to yield.\n\n#### How many vehicles were involved per crash?\n\nWe can also examine how many vehicles were involved per crash, and plot the distribution:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncount(vehicle_dat, Collision_id, name = \"Vehicles\") %>% # Count vehicles per collision\n  count(Vehicles, name = \"Crashes\") %>% # Count collisions for each number of vehicles\n  mutate(Proportion = Crashes/sum(Crashes),\n         Label = paste0(scales::percent(Proportion),\"\\n(n=\",Crashes,\")\")) %>% \n  ggplot(aes(x = Vehicles, y = Crashes, label = Label)) + \n  geom_col() + labs(x = \"Number of vehicles involved\") +\n  geom_text(nudge_y = 3000, size = 3)\n```\n\n::: {.cell-output-display}\n![Incidents by number of vehicles involved](index_files/figure-html/fig-incidents-by-vehicles-involved-1.png){#fig-incidents-by-vehicles-involved width=672}\n:::\n:::\n\n\nPerhaps unsurprisingly, the majority of crashes involved two vehicles; crashes involving three or more vehicles were relatively rare (<10% of crashes).\n\n\n## Mapping\n\nFinally, let's map the data! We'll begin by filtering out crashes missing location data, or with location (0,0):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrash_map_dat <- filter(crash_dat, Latitude != 0, Longitude != 0)\n```\n:::\n\n\nThe easiest way to check for outliers is simply to plot the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crash_map_dat, aes(x=Longitude, y=Latitude)) + \n  geom_point(size=0.05, alpha = 0.5) # Small/transparent to handle overplotting\n```\n\n::: {.cell-output-display}\n![Crash locations](index_files/figure-html/fig-basic-map-1.png){#fig-basic-map width=672}\n:::\n:::\n\n\nThe projection is a little wonky, but we can see the map taking shape. There are enough data points in our data set to make individual streets!\n\n### Individual crashes\n\nWe can improve our map by incorporating actual map data for New York City. Fortunately, most of the heavy lifting has already been done for us by the `nycgeo` package! Among other things, this package can split the geography up according to different types of administrative boundaries, from boroughs all the way down to invidual census tracts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load NYC map data (https://nycgeo.mattherman.info/index.html)\nmap_dat <- nyc_boundaries(geography = \"tract\") # Split into census tracts\n\n# Add simple features (sf) to our data set\ncrash_map_dat <- crash_map_dat %>% \n  st_as_sf(coords = c(\"Longitude\",\"Latitude\"), \n           crs=4326,\n           stringsAsFactors = FALSE)\n```\n:::\n\n\nWe can now overlay individual crashes as points on a map of census tracts:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = crash_map_dat) + \n  geom_sf(data = map_dat, mapping = NULL) +\n  geom_sf(size = 0.025, alpha = 0.25, color = \"red\") + \n  theme_void()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nold-style crs object detected; please recreate object with a recent sf::st_crs()\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Crash locations](index_files/figure-html/fig-advanced-map-1.png){#fig-advanced-map width=150%}\n:::\n:::\n\n\nPlotting crashes as individual points is useful for identifying where crashes occurred, but things get muddled by the sheer number of data points, especially where the data get dense (e.g., basically all of Manhattan). \n\n### Choropleth map\n\nThe solution is to aggregate the data by dividing the map into subsections and coloring them based on the number of crashes. We'll define the subsections based on census tracts, thus making a choropleth map!\n\nWe'll also need a way to identify which tract each crash occurred in, since our data only includes the lat/lon of the crash. Fortunately, `nyc_point_poly()` will do just this!\n\n\n::: {#tbl-crashes-per-tract .cell tbl-cap='Crashes per tract'}\n\n```{.r .cell-code}\ncrash_map_dat_tract <- nyc_point_poly(crash_map_dat, \"tract\") %>% \n  st_set_geometry(NULL)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nold-style crs object detected; please recreate object with a recent sf::st_crs()\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nTrasnsforming points to EPSG 2263\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nold-style crs object detected; please recreate object with a recent sf::st_crs()\n```\n\n\n:::\n\n```{.r .cell-code}\ncrashes_by_tract <- crash_map_dat_tract %>%\n  count(tract_id, name = \"Crashes\", sort = TRUE)\n\n\nhead(crashes_by_tract, n=10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"tract_id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Crashes\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"009300\",\"2\":\"498\"},{\"1\":\"001900\",\"2\":\"493\"},{\"1\":\"001800\",\"2\":\"477\"},{\"1\":\"038302\",\"2\":\"477\"},{\"1\":\"003300\",\"2\":\"411\"},{\"1\":\"006300\",\"2\":\"383\"},{\"1\":\"030600\",\"2\":\"374\"},{\"1\":\"014300\",\"2\":\"351\"},{\"1\":\"019900\",\"2\":\"345\"},{\"1\":\"043500\",\"2\":\"330\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n<!-- Can we predict number of crashes by tract characteristics (e.g., income/poverty)? -->\n\nNow we'll join this with our map data and plot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleft_join(map_dat,crashes_by_tract) %>% \n  ggplot() + \n  geom_sf(aes(fill = Crashes)) +\n  scale_fill_viridis_c(option = \"A\") +\n  coord_sf() +\n  theme_void() + \n  theme(legend.position = c(0.2,0.815)) # Position legend in blank area of plot\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(tract_id)`\nold-style crs object detected; please recreate object with a recent\nsf::st_crs()\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Crashes by census tract](index_files/figure-html/fig-choropleth-1.png){#fig-choropleth width=150%}\n:::\n:::\n\n\nWe can use a similar approach to plot other variables by tract. Let's look at the total number of injuries reported per tract:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninjuries_by_tract <- crash_map_dat_tract %>% \n  group_by(tract_id) %>% \n  summarise(Injuries =sum(Number_of_persons_injured)) %>% \n  ungroup()\n\nhead(injuries_by_tract, n=10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"tract_id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Injuries\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"000100\",\"2\":\"92\"},{\"1\":\"000200\",\"2\":\"95\"},{\"1\":\"000201\",\"2\":\"5\"},{\"1\":\"000202\",\"2\":\"28\"},{\"1\":\"000300\",\"2\":\"18\"},{\"1\":\"000301\",\"2\":\"4\"},{\"1\":\"000400\",\"2\":\"29\"},{\"1\":\"000501\",\"2\":\"1\"},{\"1\":\"000502\",\"2\":\"3\"},{\"1\":\"000600\",\"2\":\"34\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nleft_join(map_dat,injuries_by_tract) %>% \n  ggplot() + \n  geom_sf(aes(fill = Injuries)) +\n  scale_fill_viridis_c(option = \"A\") +\n  coord_sf() +\n  theme_void() + \n  theme(legend.position = c(0.2,0.815)) # Position legend in blank area of plot\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(tract_id)`\nold-style crs object detected; please recreate object with a recent\nsf::st_crs()\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Injuries by census tract](index_files/figure-html/fig-choropleth-Injuries-1.png){#fig-choropleth-Injuries width=150%}\n:::\n:::\n\n\n\n\n### Heatmap\n\nFor comparison, we can also make a heatmap. Same basic idea as the choropleth map (i.e., colors represent number of crashes per area), but the areas are formed by dividing the geography up into regular polygons, rather than using real-world divisions like census tracts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n  geom_sf(data = map_dat, mapping = NULL) +\n  geom_hex(data = filter(crash_dat, Latitude != 0, Longitude != 0), \n           aes(x=Longitude,y=Latitude),\n           binwidth=0.005) +\n  coord_sf(crs = 4326) +\n  scale_fill_viridis_c(option = \"A\") +\n  theme_void()+\n  theme(legend.position = c(0.2,0.815))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nold-style crs object detected; please recreate object with a recent sf::st_crs()\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Crashes by location (heatmap)](index_files/figure-html/fig-heatmap-1.png){#fig-heatmap width=672}\n:::\n:::\n\n\nPersonally, I like the choropleth map better; it's easier to see how the distribution of crashes maps onto the actual geography of the city.\n\n### Crashes by street and tract\n\nIn both of our choropleth maps, we can see a couple of tracts with high rates of crashes relative to the surrounding areas (e.g., the long tract between Brooklyn and Queens that seems to correspond to Flushing Meadows Corona Park). I'm guessing that some of these high rates of crashes may be due to freeways and expressways running through the tracts in question. Conveniently, the data set includes the names of the street on which each crash occurred! Let's look at the street with the most crashes in the top 20 tracts by crashes:\n\n\n::: {#tbl-street-crashes-per-tract .cell tbl-cap='Street with most crashes per tract'}\n\n```{.r .cell-code}\ncrash_map_dat_tract %>%\n  count(tract_id, On_street_name, name = \"Crashes\", sort = TRUE) %>% \n  drop_na(On_street_name) %>% \n  filter(tract_id %in% head(crashes_by_tract$tract_id,20)) %>% # Top 20 tracts\n  slice_max(order_by = Crashes, n=1, by = tract_id) # Street w/ most crashes\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"tract_id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"On_street_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Crashes\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"038302\",\"2\":\"GRAND CENTRAL PKWY\",\"3\":\"194\"},{\"1\":\"030600\",\"2\":\"BELT PARKWAY\",\"3\":\"128\"},{\"1\":\"009300\",\"2\":\"BRUCKNER BOULEVARD\",\"3\":\"126\"},{\"1\":\"001900\",\"2\":\"BRUCKNER BOULEVARD\",\"3\":\"98\"},{\"1\":\"043500\",\"2\":\"MAJOR DEEGAN EXPRESSWAY\",\"3\":\"79\"},{\"1\":\"001800\",\"2\":\"GOWANUS EXPY (BQE)\",\"3\":\"74\"},{\"1\":\"110400\",\"2\":\"LINDEN BOULEVARD\",\"3\":\"72\"},{\"1\":\"006300\",\"2\":\"MAJOR DEEGAN EXPRESSWAY\",\"3\":\"70\"},{\"1\":\"024700\",\"2\":\"FULTON STREET\",\"3\":\"52\"},{\"1\":\"044900\",\"2\":\"BROOKLYN QUEENS EXPRESSWAY\",\"3\":\"52\"},{\"1\":\"014300\",\"2\":\"CENTRAL PARK WEST\",\"3\":\"50\"},{\"1\":\"021800\",\"2\":\"CROSS BRONX EXPY\",\"3\":\"42\"},{\"1\":\"028300\",\"2\":\"MAJOR DEEGAN EXPRESSWAY\",\"3\":\"41\"},{\"1\":\"003300\",\"2\":\"CANAL STREET\",\"3\":\"38\"},{\"1\":\"002100\",\"2\":\"BROOKLYN QUEENS EXPRESSWAY\",\"3\":\"31\"},{\"1\":\"019900\",\"2\":\"LONG ISLAND EXPRESSWAY\",\"3\":\"31\"},{\"1\":\"004300\",\"2\":\"ATLANTIC AVENUE\",\"3\":\"30\"},{\"1\":\"012500\",\"2\":\"GRAND CENTRAL PKWY\",\"3\":\"26\"},{\"1\":\"000700\",\"2\":\"BROOKLYN QUEENS EXPRESSWAY\",\"3\":\"25\"},{\"1\":\"011900\",\"2\":\"3 AVENUE\",\"3\":\"14\"},{\"1\":\"011900\",\"2\":\"4 AVENUE\",\"3\":\"14\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nAs expected, in the tracts with the most crashes, the street with the most crashes tends to be a parkway or expressway. \n\nWhile we're at it, let's look at the top 50 streets for crashes citywide. We'll use the full data set (`crash_dat`) to include cases where the street was recorded but the latitude/longitude were not.\n\n\n::: {#tbl-street-crashes .cell tbl-cap='Street with most crashes citywide'}\n\n```{.r .cell-code}\ncrash_dat %>% \n  drop_na(On_street_name) %>% \n  mutate(On_street_name = str_to_title(On_street_name)) %>% \n  count(On_street_name, sort = TRUE, name = \"Crashes\") %>% \n  head(n=50)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"On_street_name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Crashes\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Belt Parkway\",\"2\":\"1348\"},{\"1\":\"Brooklyn Queens Expressway\",\"2\":\"905\"},{\"1\":\"Broadway\",\"2\":\"841\"},{\"1\":\"Long Island Expressway\",\"2\":\"835\"},{\"1\":\"Atlantic Avenue\",\"2\":\"717\"},{\"1\":\"Fdr Drive\",\"2\":\"694\"},{\"1\":\"Grand Central Pkwy\",\"2\":\"658\"},{\"1\":\"Cross Island Parkway\",\"2\":\"555\"},{\"1\":\"3 Avenue\",\"2\":\"547\"},{\"1\":\"Major Deegan Expressway\",\"2\":\"525\"},{\"1\":\"Linden Boulevard\",\"2\":\"486\"},{\"1\":\"Northern Boulevard\",\"2\":\"433\"},{\"1\":\"Henry Hudson Parkway\",\"2\":\"429\"},{\"1\":\"Van Wyck Expwy\",\"2\":\"418\"},{\"1\":\"Staten Island Expressway\",\"2\":\"408\"},{\"1\":\"Bruckner Boulevard\",\"2\":\"386\"},{\"1\":\"Flatbush Avenue\",\"2\":\"384\"},{\"1\":\"Cross Bronx Expy\",\"2\":\"351\"},{\"1\":\"Jamaica Avenue\",\"2\":\"340\"},{\"1\":\"Bruckner Expressway\",\"2\":\"333\"},{\"1\":\"Queens Boulevard\",\"2\":\"331\"},{\"1\":\"Eastern Parkway\",\"2\":\"313\"},{\"1\":\"2 Avenue\",\"2\":\"310\"},{\"1\":\"Bronx River Parkway\",\"2\":\"310\"},{\"1\":\"Verrazano Bridge Upper\",\"2\":\"310\"},{\"1\":\"Bushwick Avenue\",\"2\":\"309\"},{\"1\":\"Bedford Avenue\",\"2\":\"303\"},{\"1\":\"Fulton Street\",\"2\":\"303\"},{\"1\":\"Hylan Boulevard\",\"2\":\"301\"},{\"1\":\"Triborough Bridge\",\"2\":\"300\"},{\"1\":\"Nostrand Avenue\",\"2\":\"296\"},{\"1\":\"4 Avenue\",\"2\":\"290\"},{\"1\":\"Myrtle Avenue\",\"2\":\"266\"},{\"1\":\"Utica Avenue\",\"2\":\"266\"},{\"1\":\"Jerome Avenue\",\"2\":\"250\"},{\"1\":\"Jackie Robinson Pkwy\",\"2\":\"242\"},{\"1\":\"5 Avenue\",\"2\":\"239\"},{\"1\":\"Amsterdam Avenue\",\"2\":\"238\"},{\"1\":\"Pennsylvania Avenue\",\"2\":\"229\"},{\"1\":\"Grand Concourse\",\"2\":\"225\"},{\"1\":\"Kings Highway\",\"2\":\"224\"},{\"1\":\"Ocean Parkway\",\"2\":\"224\"},{\"1\":\"Liberty Avenue\",\"2\":\"222\"},{\"1\":\"Grand Central Parkway\",\"2\":\"221\"},{\"1\":\"Metropolitan Avenue\",\"2\":\"216\"},{\"1\":\"Park Avenue\",\"2\":\"216\"},{\"1\":\"Webster Avenue\",\"2\":\"214\"},{\"1\":\"Rockaway Boulevard\",\"2\":\"210\"},{\"1\":\"8 Avenue\",\"2\":\"209\"},{\"1\":\"1 Avenue\",\"2\":\"206\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n# Future Directions\n\nWhat we've done so far barely scratches the surface of the data set; I went for breadth over depth in this post. Here's a handful of ways I'd like to explore the data further (these may be featured in future blog posts):\n\n- Incorporate data from previous years and examine whether number of crashes/injuries/fatalities changes with start/end of daylight savings time.\n- Explore whether specific vehicle types or contributing factors predict greater likelihood of injuries/fatalities.\n- Combine with other data sets\n  - Road hours by vehicle type: are certain vehicle types disproportionately likely to be involved in crashes?\n  - Census tract data: do tract characteristics (e.g., income, employment) predict frequency of crashes?\n- Interactivity! Use `leaflet` and `shiny` to build an interactive map of crash data, allowing users to zoom/scroll the map and filter by date range, vehicle type, contributing factor, and more.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}